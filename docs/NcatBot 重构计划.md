# NcatBot 重构计划

## 总体计划

- 分为 CLI、插件系统、本体三部分
- CLI、插件系统、本体放在同一个仓库，打包为一个 PYPI pkg 发布

## 本体

### 功能

- 安装，配置，启动 NAPCAT。
- 配置**插件无关**的一些东西，例如 ROOT 权限，通信端口等。
- 提供 Python Style NAPCAT API。
- 启动插件系统。

### 特性（是否支持有待讨论）


### 与插件系统的交互

- 通过插件系统的 EventBus 向插件系统
- 启动插件系统时向其传递 BotAPI，config。

### 与 CLI 的交互

- 支持通过 CLI 写入本体配置项（QQ号等）
- 保留当前的启动方式（阻塞模式启动，插件模式启动）

### 特别提醒

- Config 应该作为**实例**在各个系统中**传递**，而非作为全局变量使用。

## 插件系统

### 功能

- 定时任务。
- 权限系统（用户权限 + 群组权限）
- 插件功能：
  - 插件功能是对**事件订阅和事件处理**的抽象，专注于处理**消息事件**
  - 插件功能需要接入权限系统对功能触发者进行鉴权。
- 内置功能：
  - 内置功能提供通过 QQ 发送消息与**插件系统**进行交互的能力，通过内置功能可以管理**全部插件**

### 与 CLI 的交互

- 提供一个获取插件基本信息的接口。

## CLI

### 功能

- 管理插件的**安装和卸载**。
- 后台管理**插件系统权限**。
- 开发者创建插件。
- 开发者发布插件。
- 管理 NcatBot 本体的更新。
- 管理 NcatBot 的配置。
- NcatBot 启动。

### 总体构想

- 基本保持现有 CLI 不变，将 publish 的代码移动到这一部分。
- 需要插件系统提供读取插件元数据的功能，需要本体提供用于启动的函数。

## GUI

### 总体构想

- 使用 WEB 端的模式构建。
- 基于 CLI 提供的功能构建。